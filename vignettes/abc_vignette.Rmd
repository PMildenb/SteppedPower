---
title: "SteppedPower"
author: "Philipp Mildenberger"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Stepped Power}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## About `SteppedPower`

The package `SteppedPower` aims at providing tools for power calculation 
and design diagnostics in interventional study designs,
with special focus on stepped wedge designs.  

This code is highly modularised in order to be flexible and easy to use 
(and hopefully maintain as well). 
At the same time, the use of sparse matrix classes of the wonderful `matrix` 
package makes computaion fast (and numerically stable).


## A quick tour

For most users, the probably most important function is `wlsMixedPower`. 
It calls `compute_wlsPower`, which is the workhorse function of this package.

### Define Study and Analysis Design

`construct_DesMat` 


### Define assumed Covariance Structure

`construct_CovMat`


### Gimmicks

`plot` method



## Use cases

### Comparison of two groups -- Z-Test and t-Test
Lets first start with a rather simple example where we want to compare the 
mean in two groups. The Z-test can be expressed as  follows:
```{r}
wlsMixedPower(Cl=c(10,10), sigma=.5, EffSize=.3, N=1, design="parallel")
```
If not specified, the number of timepoints is guessed as the fewest number of periods (timepoints) possible with the given design; in this case, one period.
```{r}
wlsMixedPower(Cl=c(10,10), sigma=.5, EffSize=.3, N=1, design="parallel", timepoints=1)
## the same:
wlsMixedPower(Cl=c(1,1), sigma=.5, EffSize=.3, N=10, design="parallel", timepoints=1)

pwr::pwr.norm.test(.6,n=10)

```

To calculate a t-test, we would have to specify a degrees of freedom adjustment:
```{r}
wlsMixedPower(Cl=c(10,20), sigma=.5, EffSize=.3, N=1, df_adjust="residual",
                   timepoints=1, design="parallel")
wlsMixedPower(Cl=c(10,10), sigma=.5, EffSize=.3, N=1, df_adjust="between-within",
                   timepoints=1, design="parallel")

pwr::pwr.t.test(10,.6,type="two.sample")
```

Note that two of the three implemented adjustment methods simplify to students t-test.
Welshs t-test cannot be easily reproduced in `SteppedPower`.

```{r}
## paired t-test
wlsMixedPower(Cl=c(0,10), design="parallel_baseline", time_adjust="none", EffSize=.3, sigma=.5, 
              N=1, df_adjust="between-within")

## one-sample t-test
wlsMixedPower(Cl=c(0,10), design="parallel", time_adjust="none", EffSize=.3, sigma=.5, 
              N=1, df_adjust="between-within")

pwr::pwr.t.test(10, d=.6, type="one.sample") ### NOT THE SAME (!!!)
```

##  


## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

